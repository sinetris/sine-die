{{- define "sidebar"}}<!-- hide sdebar -->{{ end -}}

{{- define "main" }}
  {{/* Build alphabetical index. */}}
  {{/* Note: Hugo support for diatrics is currently subpar. */}}
  {{- $pagesList := slice }}
  {{- range $p := .Pages }}
    {{- $key := substr .Title 0 1 | upper }}
    {{ if or (eq $key "0") (lt $key "A") (gt $key "Z") }}
      {{- $key = "#" }}
    {{- end }}
    {{ $titleSort := printf "%s %s" $key (upper .Title) }}
    {{ $pagesList = $pagesList | append (dict "key" $key "titleSort" $titleSort "page" .) }}
  {{- end }}
  <section role="doc-glossary" aria-labelledby="glossary-title">
    <header>
    {{- with .Params.Title -}}
      <h1 id="glossary-title">{{ . }}</h1>
    {{- end -}}
    {{- if .Description -}}
      {{- with .Description -}}
        <p role="note">{{ . }}</p>
      {{- end -}}
    {{- else -}}
      <p role="note">
        A glossary is a list of terms, abbreviations, or expressions in a particular
        context or field of knowledge with their respective definitions.
      </p>
    {{- end -}}
    {{ if len $pagesList }}
      {{/* Render alphabetical index. */}}
      <nav aria-labelledby="glossary-index">
        <h2 id="glossary-index">Glossary Index</h2>
        <ul>
          {{- $glossary_index := slice }}
          {{- range sort $pagesList ".titleSort" }}
            {{- if in $glossary_index .key }}
              {{- continue }}
            {{- end }}
            {{- $glossary_index = append $glossary_index (slice .key) }}
            {{- $anchor := path.BaseName .page.Path | anchorize }}
            <li>
              <a href="#{{ $anchor }}">{{ .key }}</a>
            </li>
          {{- end }}
        </ul>
      </nav>
    {{- end }}
    </header>
    {{ .Content }}
    <section class="glossary-terms">
      {{ range sort $pagesList ".titleSort" }}
        {{ partial "glossary/term.html" (dict "page" .page "options" (dict "embedded" true)) }}
      {{ end }}
    </section>
  </section>
{{ end -}}
